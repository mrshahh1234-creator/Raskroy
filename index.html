<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mustafayev Academy | XML Cutting Terminal</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #1e293b;
            --accent: #10b981;
            --blue: #3b82f6;
            --text: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; display: flex; flex-direction: column; height: 100vh;
        }

        header {
            padding: 20px 40px;
            background: var(--panel);
            border-bottom: 2px solid var(--blue);
            display: flex; justify-content: space-between; align-items: center;
        }

        .controls {
            padding: 20px 40px;
            background: rgba(30, 41, 59, 0.5);
            display: flex; gap: 15px; align-items: center;
        }

        .btn-load {
            background: var(--blue);
            color: white; padding: 12px 25px; border-radius: 8px;
            cursor: pointer; font-weight: bold; border: none; transition: 0.2s;
        }

        .btn-load:hover { background: #2563eb; transform: scale(1.02); }

        /* –†–∞–±–æ—á–∞—è –∑–æ–Ω–∞ */
        .workspace {
            flex: 1;
            display: flex; justify-content: center; align-items: center;
            padding: 40px; overflow: auto;
        }

        #plate {
            position: relative;
            background: #334155;
            border: 2px solid #64748b;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .part {
            position: absolute;
            background: #475569;
            border: 1px solid rgba(255,255,255,0.2);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
            overflow: hidden; font-size: 11px; text-align: center;
        }

        .part:hover { background: #334155; border-color: var(--blue); z-index: 10; }

        /* –ö–æ–≥–¥–∞ –¥–µ—Ç–∞–ª—å –ø–æ—Ä–µ–∑–∞–Ω–∞ –∏ –Ω–∞–∂–∞—Ç–∞ */
        .part.is-cut {
            background: var(--accent) !important;
            opacity: 0.6;
        }

        footer {
            padding: 15px 40px;
            text-align: right;
            background: var(--panel);
            font-size: 18px;
        }

        footer b { color: var(--accent); }

        /* –ü–µ—á–∞—Ç—å */
        @media print {
            .no-print { display: none !important; }
            #print-area { display: block !important; }
        }
        #print-area { display: none; color: black; font-family: Arial; }
    </style>
</head>
<body>

<header class="no-print">
    <h1>MUSTAFAYEV FACTORY <span style="font-weight: 200; font-size: 14px;">| XML IMPORT</span></h1>
    <div id="clock"></div>
</header>

<div class="controls no-print">
    <label class="btn-load">üì• –ò–ú–ü–û–†–¢ XML / CUT
        <input type="file" id="fileInput" accept=".xml,.cut" style="display:none" onchange="handleFile(event)">
    </label>
    <div id="file-info" style="color: var(--blue)">–û–∂–∏–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Ä–∞—Å–∫—Ä–æ—è...</div>
</div>

<div class="workspace no-print">
    <div id="plate"></div>
</div>

<footer class="no-print">
    Mustafayev <b>Academy</b>
</footer>

<div id="print-area">
    <div style="border: 2px solid black; padding: 15px; width: 60mm; margin: auto; text-align: center;">
        <div style="border-bottom: 1px solid black; font-size: 10pt;">MUSTAFAYEV ACADEMY</div>
        <h2 id="p-name" style="margin: 10px 0;"></h2>
        <h1 id="p-size" style="font-size: 28pt; margin: 5px 0;"></h1>
        <div id="p-order"></div>
        <div id="p-date" style="font-size: 8pt; margin-top: 10px;"></div>
    </div>
</div>

<script>
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

    const SCALE = 0.4; // –ú–∞—Å—à—Ç–∞–± –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

    function handleFile(event) {
        const file = event.target.files[0];
        if (!file) return;
        document.getElementById('file-info').innerText = "–§–∞–π–ª: " + file.name;

        const reader = new FileReader();
        reader.onload = function(e) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(e.target.result, "text/xml");
            
            // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Ä–∞–∑–º–µ—Ä—ã –æ—Å–Ω–æ–≤–Ω–æ–π –ø–ª–∏—Ç—ã (Sheet)
            const sheet = xmlDoc.getElementsByTagName("Sheet")[0] || xmlDoc.getElementsByTagName("Panel")[0];
            const pW = sheet ? parseInt(sheet.getAttribute("Width")) : 2800;
            const pH = sheet ? parseInt(sheet.getAttribute("Height")) : 2070;

            renderLayout(xmlDoc, pW, pH);
        };
        reader.readAsText(file);
    }

    function renderLayout(xml, pW, pH) {
        const plate = document.getElementById('plate');
        plate.innerHTML = '';
        plate.style.width = (pW * SCALE) + 'px';
        plate.style.height = (pH * SCALE) + 'px';

        // –ò—â–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–µ—Ç–∞–ª–µ–π (–≤ XML –æ–Ω–∏ —á–∞—Å—Ç–æ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è Part –∏–ª–∏ Item)
        const parts = xml.getElementsByTagName("Part");
        
        for (let i = 0; i < parts.length; i++) {
            const p = parts[i];
            const x = parseInt(p.getAttribute("X") || 0);
            const y = parseInt(p.getAttribute("Y") || 0);
            const w = parseInt(p.getAttribute("Width") || 0);
            const h = parseInt(p.getAttribute("Height") || 0);
            const name = p.getAttribute("Name") || "–î–µ—Ç–∞–ª—å";
            const order = p.getAttribute("Order") || "–ó–∞–∫–∞–∑";

            const div = document.createElement('div');
            div.className = 'part';
            div.style.left = (x * SCALE) + 'px';
            div.style.top = (y * SCALE) + 'px';
            div.style.width = (w * SCALE) + 'px';
            div.style.height = (h * SCALE) + 'px';
            
            if (w > 80 && h > 40) {
                div.innerHTML = `<b>${name}</b><br>${w}x${h}`;
            }

            div.onclick = function() {
                this.classList.toggle('is-cut');
                printLabel(name, w + 'x' + h, order);
            };

            plate.appendChild(div);
        }
    }

    function printLabel(name, size, order) {
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-size').innerText = size;
        document.getElementById('p-order').innerText = "–ó–ê–ö–ê–ó: " + order;
        document.getElementById('p-date').innerText = new Date().toLocaleString();
        window.print();
    }
</script>
</body>
</html>
