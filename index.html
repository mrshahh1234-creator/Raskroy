<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>GibLab Web PRO | Nanxing ND510S</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <style>
        :root { --nx-blue: #0054a6; --nx-red: #e30613; --bg: #f0f2f5; }
        body { margin: 0; font-family: 'Segoe UI', Arial; display: flex; height: 100vh; background: var(--bg); font-size: 13px; }
        
        .sidebar { width: 230px; background: #2c3e50; color: white; padding: 15px; display: flex; flex-direction: column; }
        .logo-area { text-align: center; margin-bottom: 20px; padding: 10px; background: white; border-radius: 5px; }
        .logo-text { color: var(--nx-blue); font-weight: bold; font-size: 22px; }
        
        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .btn { background: var(--nx-blue); border: none; color: white; padding: 12px; margin: 4px 0; cursor: pointer; border-radius: 4px; font-weight: bold; text-align: left; }
        .btn:hover { opacity: 0.9; transform: translateX(3px); transition: 0.2s; }
        .btn-import { background: #8e44ad; } /* –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ */
        .btn-save { background: #27ae60; }   /* –ó–µ–ª–µ–Ω—ã–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è */
        
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .tabs { background: #ddd; display: flex; padding: 5px 5px 0; }
        .tab { padding: 10px 20px; cursor: pointer; background: #ccc; margin-right: 5px; border-radius: 5px 5px 0 0; }
        .tab.active { background: white; font-weight: bold; border-bottom: 2px solid var(--nx-blue); }

        .content-section { flex: 1; overflow-y: auto; background: white; padding: 15px; display: none; }
        .content-section.active { display: block; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f1f1f1; border: 1px solid #ccc; padding: 8px; sticky: top; }
        td { border: 1px solid #ccc; padding: 6px; text-align: center; }
        input[type="number"], input[type="text"] { width: 90%; padding: 4px; border: 1px solid #ddd; }

        /* –î–∏–∑–∞–π–Ω —ç—Ç–∏–∫–µ—Ç–∫–∏ */
        .label-grid { display: grid; grid-template-columns: repeat(auto-fill, 80mm); gap: 15px; }
        .label-card { width: 80mm; height: 50mm; border: 2px solid #000; padding: 10px; position: relative; box-sizing: border-box; }
        .label-qr { position: absolute; bottom: 5px; right: 5px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo-area">
        <div class="logo-text">NANXING</div>
        <div style="color:#666; font-size:10px">SYSTEM CONTROL</div>
    </div>

    <button class="btn btn-import" onclick="document.getElementById('fileInput').click()">üì• –ò–ú–ü–û–†–¢ .PROJECT</button>
    <input type="file" id="fileInput" style="display:none" accept=".project,.json" onchange="importProject(event)">
    
    <button class="btn btn-save" onclick="exportProject()">üíæ –°–û–•–†–ê–ù–ò–¢–¨ .PROJECT</button>
    <hr style="width:100%; border: 0; border-top: 1px solid #555; margin: 10px 0;">
    
    <button class="btn" onclick="addPart()">+ –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å</button>
    <button class="btn" onclick="runNesting()" style="background:#e67e22">‚ö° –†–ê–°–°–ß–ò–¢–ê–¢–¨</button>
    <button class="btn" onclick="switchTab('labels')">üè∑Ô∏è –≠–¢–ò–ö–ï–¢–ö–ò</button>
</div>

<div class="main">
    <div class="tabs">
        <div id="t-parts" class="tab active" onclick="switchTab('parts')">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</div>
        <div id="t-labels" class="tab" onclick="switchTab('labels')">–≠—Ç–∏–∫–µ—Ç–∫–∏ (ND510S)</div>
    </div>

    <div id="sec-parts" class="content-section active">
        <h3 id="projectNameDisplay">–ü—Ä–æ–µ–∫—Ç: –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h3>
        <table>
            <thead>
                <tr>
                    <th>‚Ññ</th>
                    <th>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                    <th>L (–º–º)</th>
                    <th>W (–º–º)</th>
                    <th>–ö–æ–ª-–≤–æ</th>
                    <th>–ü—Ä–æ–≥—Ä–∞–º–º–∞ (.ban)</th>
                    <th>–£–¥–∞–ª–∏—Ç—å</th>
                </tr>
            </thead>
            <tbody id="partsTableBody"></tbody>
        </table>
    </div>

    <div id="sec-labels" class="content-section">
        <div class="label-grid" id="labelsContainer"></div>
    </div>
</div>

<script>
    let projectData = {
        name: "Amir_Project_01",
        parts: [
            { id: 1, name: "–ë–æ–∫ –ª–µ–≤—ã–π", l: 700, w: 500, count: 2, prg: "side_l.ban" },
            { id: 2, name: "–ö—Ä—ã—à–∫–∞", l: 1000, w: 500, count: 1, prg: "top.ban" }
        ]
    };

    // –§–£–ù–ö–¶–ò–Ø –ò–ú–ü–û–†–¢–ê .PROJECT
    function importProject(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const imported = JSON.parse(e.target.result);
                if (imported.parts) {
                    projectData = imported;
                    document.getElementById('projectNameDisplay').innerText = "–ü—Ä–æ–µ–∫—Ç: " + (projectData.name || "–ó–∞–≥—Ä—É–∂–µ–Ω");
                    renderTable();
                    alert("–ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!");
                }
            } catch (err) {
                alert("–û—à–∏–±–∫–∞: –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ .project");
            }
        };
        reader.readAsText(file);
    }

    // –§–£–ù–ö–¶–ò–Ø –≠–ö–°–ü–û–†–¢–ê .PROJECT
    function exportProject() {
        const dataStr = JSON.stringify(projectData, null, 2);
        const blob = new Blob([dataStr], {type: "application/json"});
        saveAs(blob, (projectData.name || "export") + ".project");
    }

    function renderTable() {
        const body = document.getElementById('partsTableBody');
        body.innerHTML = '';
        projectData.parts.forEach((p, i) => {
            body.innerHTML += `
                <tr>
                    <td>${i+1}</td>
                    <td><input type="text" value="${p.name}" onchange="projectData.parts[${i}].name=this.value"></td>
                    <td><input type="number" value="${p.l}" onchange="projectData.parts[${i}].l=Number(this.value)"></td>
                    <td><input type="number" value="${p.w}" onchange="projectData.parts[${i}].w=Number(this.value)"></td>
                    <td><input type="number" value="${p.count}" onchange="projectData.parts[${i}].count=Number(this.value)"></td>
                    <td><input type="text" value="${p.prg}" onchange="projectData.parts[${i}].prg=this.value"></td>
                    <td><button onclick="deletePart(${i})">‚ùå</button></td>
                </tr>`;
        });
    }

    function addPart() {
        projectData.parts.push({ id: Date.now(), name: "–î–µ—Ç–∞–ª—å", l: 600, w: 400, count: 1, prg: "new.ban" });
        renderTable();
    }

    function deletePart(index) {
        projectData.parts.splice(index, 1);
        renderTable();
    }

    function switchTab(target) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('sec-' + target).classList.add('active');
        document.getElementById('t-' + target).classList.add('active');
        if(target === 'labels') generateLabels();
    }

    function generateLabels() {
        const container = document.getElementById('labelsContainer');
        container.innerHTML = '';
        projectData.parts.forEach((p, idx) => {
            for(let i=0; i < p.count; i++) {
                const labelId = `qr-${idx}-${i}`;
                const card = document.createElement('div');
                card.className = 'label-card';
                card.innerHTML = `
                    <div style="border-bottom: 2px solid #000; font-weight: bold; display:flex; justify-content:space-between">
                        <span>NANXING ND510S</span> <span>${i+1}/${p.count}</span>
                    </div>
                    <div style="font-size: 16px; margin: 5px 0;">${p.name}</div>
                    <div style="font-size: 24px; font-weight: 900;">${p.l} x ${p.w}</div>
                    <div style="font-size: 11px; margin-top:10px;">–ü—Ä–æ–≥—Ä–∞–º–º–∞: <b>${p.prg}</b></div>
                    <div id="${labelId}" class="label-qr"></div>
                `;
                container.appendChild(card);
                new QRCode(document.getElementById(labelId), { text: p.prg, width: 60, height: 60 });
            }
        });
    }

    renderTable();
</script>
</body>
</html>
