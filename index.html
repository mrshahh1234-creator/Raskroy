<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мини-GIBLAB Раскрой</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; }
        .controls { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin: 20px; }
        canvas { background: white; border: 2px solid #333; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        input { width: 60px; margin-right: 10px; }
        button { padding: 8px 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>

    <h2>Прототип системы раскроя (Nesting)</h2>

    <div class="controls">
        <b>Лист (мм):</b> 
        W: <input type="number" id="sheetW" value="2800"> 
        H: <input type="number" id="sheetH" value="2070">
        <br><br>
        <b>Деталь (мм):</b> 
        w: <input type="number" id="partW" value="400"> 
        h: <input type="number" id="partH" value="300">
        Кол-во: <input type="number" id="partCount" value="15">
        <button onclick="runNesting()">Рассчитать раскрой</button>
    </div>

    <canvas id="nestingCanvas"></canvas>

    <script>
        function runNesting() {
            const sw = parseInt(document.getElementById('sheetW').value);
            const sh = parseInt(document.getElementById('sheetH').value);
            const pw = parseInt(document.getElementById('partW').value);
            const ph = parseInt(document.getElementById('partH').value);
            const count = parseInt(document.getElementById('partCount').value);

            const canvas = document.getElementById('nestingCanvas');
            const ctx = canvas.getContext('2d');

            // Масштабирование для отображения на экране
            const scale = Math.min(800 / sw, 600 / sh);
            canvas.width = sw * scale;
            canvas.height = sh * scale;

            // Алгоритм упаковки (Shelf Packing - полочный метод)
            let currentX = 0;
            let currentY = 0;
            let shelfHeight = 0;
            let packedCount = 0;

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = "#333";
            ctx.lineWidth = 1;

            for (let i = 0; i < count; i++) {
                // Проверяем, помещается ли деталь по ширине
                if (currentX + pw > sw) {
                    currentX = 0;
                    currentY += shelfHeight;
                    shelfHeight = 0;
                }

                // Проверяем, помещается ли по высоте
                if (currentY + ph > sh) {
                    console.log("Место закончилось!");
                    break;
                }

                // Рисуем деталь
                ctx.fillStyle = `hsl(${(i * 45) % 360}, 70%, 60%)`;
                ctx.fillRect(currentX * scale, currentY * scale, pw * scale, ph * scale);
                ctx.strokeRect(currentX * scale, currentY * scale, pw * scale, ph * scale);

                // Обновляем координаты для следующей детали
                currentX += pw;
                shelfHeight = Math.max(shelfHeight, ph);
                packedCount++;
            }

            alert(`Размещено деталей: ${packedCount} из ${count}`);
        }

        // Запуск при загрузке
        window.onload = runNesting;
    </script>
</body>
</html>
