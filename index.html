<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mustafayev Academy | BAZIS Terminal</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel-bg: #1e293b;
            --accent: #10b981;
            --blue: #3b82f6;
            --text: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; display: flex; flex-direction: column; height: 100vh;
        }

        header {
            padding: 15px 40px;
            background: var(--panel-bg);
            border-bottom: 2px solid var(--accent);
            display: flex; justify-content: space-between; align-items: center;
        }

        .controls {
            padding: 20px 40px;
            background: rgba(30, 41, 59, 0.5);
            display: flex; gap: 20px; align-items: center;
        }

        .btn-load {
            background: var(--blue);
            color: white; padding: 12px 25px; border-radius: 8px;
            cursor: pointer; font-weight: bold; border: none;
        }

        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∏—Ç */
        .workspace {
            flex: 1;
            padding: 40px;
            overflow: auto;
            display: flex; flex-direction: column; align-items: center; gap: 50px;
        }

        .sheet-container {
            position: relative;
            background: #334155;
            border: 2px solid #64748b;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .part {
            position: absolute;
            background: #475569;
            border: 1px solid rgba(255,255,255,0.3);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s;
            font-size: 10px; color: white; text-align: center;
            box-sizing: border-box;
        }

        .part:hover { background: var(--blue); z-index: 10; transform: scale(1.02); }
        .part.is-cut { background: var(--accent) !important; opacity: 0.6; }

        .sheet-label {
            position: absolute; top: -30px; left: 0;
            color: var(--accent); font-weight: bold;
        }

        footer {
            padding: 15px 40px; text-align: right;
            background: var(--panel-bg); border-top: 1px solid #334155;
        }
        footer b { color: var(--accent); }

        @media print {
            .no-print { display: none !important; }
            #print-area { display: block !important; }
        }
        #print-area { display: none; color: black; font-family: Arial; padding: 20px; text-align: center; }
    </style>
</head>
<body>

<header class="no-print">
    <h1>MUSTAFAYEV FACTORY <span style="font-size: 14px; opacity: 0.7;">| BAZIS-CUTTING</span></h1>
    <div id="clock"></div>
</header>

<div class="controls no-print">
    <label class="btn-load">üì• –ó–ê–ì–†–£–ó–ò–¢–¨ –ö–ê–†–¢–£ (.XML)
        <input type="file" id="fileInput" accept=".xml" style="display:none" onchange="processBazisXml(event)">
    </label>
    <div id="material-info" style="color: var(--accent)">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Ä–∞—Å–∫—Ä–æ—è</div>
</div>

<div class="workspace no-print" id="workspace">
    </div>

<footer class="no-print">
    Mustafayev <b>Academy</b>
</footer>

<div id="print-area">
    <div style="border: 2px solid black; padding: 10px; width: 60mm; margin: auto;">
        <div style="font-size: 10pt; border-bottom: 1px solid #000;">MUSTAFAYEV ACADEMY</div>
        <h2 id="p-name" style="margin: 10px 0; font-size: 16pt;"></h2>
        <h1 id="p-size" style="font-size: 24pt; margin: 5px 0;"></h1>
        <div id="p-mat" style="font-size: 10pt; margin-bottom: 5px;"></div>
        <div id="p-date" style="font-size: 8pt; opacity: 0.8;"></div>
    </div>
</div>

<script>
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

    const SCALE = 0.3; // 1–º–º = 0.3px

    function processBazisXml(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const parser = new DOMParser();
            const xml = parser.parseFromString(e.target.result, "text/xml");
            renderWorkspace(xml);
        };
        reader.readAsText(file);
    }

    function renderWorkspace(xml) {
        const workspace = document.getElementById('workspace');
        workspace.innerHTML = '';

        // –ò—â–µ–º –≤—Å–µ –ø–ª–∏—Ç—ã (panel0, panel1...)
        const panels = xml.querySelectorAll('[material]');
        
        panels.forEach((panel, pIdx) => {
            const pL = parseInt(panel.getAttribute('l'));
            const pW = parseInt(panel.getAttribute('w'));
            const material = panel.getAttribute('material');
            
            document.getElementById('material-info').innerText = "–ú–∞—Ç–µ—Ä–∏–∞–ª: " + material;

            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–∏—Ç—ã
            const sheetCont = document.createElement('div');
            sheetCont.className = 'sheet-container';
            sheetCont.style.width = (pL * SCALE) + 'px';
            sheetCont.style.height = (pW * SCALE) + 'px';
            sheetCont.innerHTML = `<div class="sheet-label">–ü–õ–ò–¢–ê ‚Ññ${pIdx + 1} (${pL}x${pW})</div>`;

            // –ò—â–µ–º –¥–µ—Ç–∞–ª–∏ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –ø–ª–∏—Ç—ã (no.1, no.2...)
            const parts = panel.children;
            for (let part of parts) {
                const l = parseFloat(part.getAttribute('l'));
                const w = parseFloat(part.getAttribute('w'));
                const x = parseFloat(part.getAttribute('x'));
                const y = parseFloat(part.getAttribute('y'));
                const id = part.getAttribute('id');

                // –†–∏—Å—É–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç —Ä–∞–∑–º–µ—Ä—ã –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                if (l && w) {
                    const div = document.createElement('div');
                    div.className = 'part';
                    div.style.left = (x * SCALE) + 'px';
                    div.style.top = (y * SCALE) + 'px';
                    div.style.width = (l * SCALE) + 'px';
                    div.style.height = (w * SCALE) + 'px';

                    // –ï—Å–ª–∏ –¥–µ—Ç–∞–ª—å –±–æ–ª—å—à–∞—è, –ø–∏—à–µ–º —Ä–∞–∑–º–µ—Ä
                    if (l * SCALE > 40) div.innerText = l + 'x' + w;

                    div.onclick = function() {
                        this.classList.toggle('is-cut');
                        printLabel("–î–µ—Ç–∞–ª—å ID:" + id, l + 'x' + w, material);
                    };
                    sheetCont.appendChild(div);
                }
            }
            workspace.appendChild(sheetCont);
        });
    }

    function printLabel(name, size, mat) {
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-size').innerText = size;
        document.getElementById('p-mat').innerText = mat;
        document.getElementById('p-date').innerText = new Date().toLocaleString();
        window.print();
    }
</script>
</body>
</html>
