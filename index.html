<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mustafayev Academy | Visual Cutting</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --panel-bg: rgba(30, 41, 59, 0.8);
            --accent-green: #10b981;
            --accent-blue: #3b82f6;
            --text-main: #f8fafc;
            --detail-color: #334155;
            --detail-cut: #065f46;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-color);
            color: var(--text-main);
            margin: 0; padding: 0;
            overflow: hidden; /* –§–∏–∫—Å–∏—Ä—É–µ–º —ç–∫—Ä–∞–Ω —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ */
            display: flex; flex-direction: column; height: 100vh;
        }

        header {
            padding: 15px 40px;
            background: #1e293b;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid var(--accent-blue);
        }

        .controls {
            padding: 20px 40px;
            background: var(--panel-bg);
            display: flex; gap: 20px; align-items: center;
        }

        .btn-load {
            background: var(--accent-blue);
            color: white; padding: 12px 25px; border-radius: 8px;
            cursor: pointer; font-weight: bold; border: none;
        }

        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∏—Ç—ã */
        .cutting-area {
            flex: 1;
            padding: 40px;
            display: flex; justify-content: center; align-items: center;
            overflow: auto;
        }

        #plate {
            position: relative;
            background: #1e293b;
            border: 3px solid #475569;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            transition: 0.3s;
        }

        .detail {
            position: absolute;
            border: 1px solid rgba(255,255,255,0.2);
            background: var(--detail-color);
            display: flex;
            align-items: center; justify-content: center;
            color: white; font-size: 12px; font-weight: bold;
            cursor: pointer; overflow: hidden;
            transition: all 0.2s;
        }

        .detail:hover { filter: brightness(1.3); border: 1px solid var(--accent-blue); }

        /* –°—Ç–∏–ª—å –¥–ª—è —É–∂–µ –ø–æ—Ä–µ–∑–∞–Ω–Ω–æ–π –¥–µ—Ç–∞–ª–∏ */
        .detail.cut {
            background: var(--detail-cut) !important;
            border-color: var(--accent-green);
            opacity: 0.6;
        }

        footer {
            padding: 15px 40px;
            text-align: right;
            background: #0f172a;
            font-size: 18px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        footer b { color: var(--accent-green); }

        /* –ü–µ—á–∞—Ç—å */
        @media print {
            .no-print { display: none !important; }
            #print-area { display: block !important; }
        }
        #print-area { display: none; color: black; text-align: center; font-family: Arial; }
    </style>
</head>
<body>

<header class="no-print">
    <div><h1>MUSTAFAYEV FACTORY <span style="font-weight: 200; font-size: 16px;">| VISUAL CUT v2.0</span></h1></div>
    <div id="clock">00:00:00</div>
</header>

<div class="controls no-print">
    <label class="btn-load">üì• –ó–ê–ì–†–£–ó–ò–¢–¨ –ö–ê–†–¢–£ –†–ê–°–ö–†–û–Ø (.BIR)
        <input type="file" id="fileInput" accept=".bir" style="display:none" onchange="loadBir(event)">
    </label>
    <div id="file-status" style="color: var(--accent-blue)">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã</div>
</div>

<div class="cutting-area no-print">
    <div id="plate">
        </div>
</div>

<footer class="no-print">
    Mustafayev <b>Academy</b>
</footer>

<div id="print-area">
    <div style="border: 2px solid black; padding: 15px; width: 60mm; margin: auto;">
        <div style="font-size: 10pt; border-bottom: 1px solid #000;">MUSTAFAYEV ACADEMY</div>
        <h2 id="p-name" style="margin: 10px 0; font-size: 16pt;"></h2>
        <h1 id="p-size" style="font-size: 28pt; margin: 5px 0;"></h1>
        <div id="p-order" style="font-size: 12pt;"></div>
        <div id="p-time" style="font-size: 8pt; margin-top: 10px;"></div>
    </div>
</div>

<script>
    setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

    const plate = document.getElementById('plate');
    const scale = 0.5; // –ú–∞—Å—à—Ç–∞–± –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ (1–º–º = 0.5px)

    function loadBir(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            renderPlate(lines);
        };
        reader.readAsText(file);
    }

    function renderPlate(lines) {
        plate.innerHTML = '';
        
        // –î–æ–ø—É—Å—Ç–∏–º, –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Ñ–∞–π–ª–∞ .bir - —ç—Ç–æ —Ä–∞–∑–º–µ—Ä –ø–ª–∏—Ç—ã: –®–∏—Ä–∏–Ω–∞;–í—ã—Å–æ—Ç–∞
        // –ù–∞–ø—Ä–∏–º–µ—Ä: 2800;2070
        const plateSize = lines[0].split(';');
        const pWidth = parseInt(plateSize[0]) || 2800;
        const pHeight = parseInt(plateSize[1]) || 2070;

        plate.style.width = (pWidth * scale) + 'px';
        plate.style.height = (pHeight * scale) + 'px';

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ - —ç—Ç–æ –¥–µ—Ç–∞–ª–∏: X; Y; –®–∏—Ä–∏–Ω–∞; –í—ã—Å–æ—Ç–∞; –ò–º—è; –ó–∞–∫–∞–∑
        for (let i = 1; i < lines.length; i++) {
            const parts = lines[i].split(';');
            if (parts.length < 4) continue;

            const x = parseInt(parts[0]);
            const y = parseInt(parts[1]);
            const w = parseInt(parts[2]);
            const h = parseInt(parts[3]);
            const name = parts[4] || "–î–µ—Ç–∞–ª—å";
            const order = parts[5] || "–ë/–ó";

            const div = document.createElement('div');
            div.className = 'detail';
            div.style.left = (x * scale) + 'px';
            div.style.top = (y * scale) + 'px';
            div.style.width = (w * scale) + 'px';
            div.style.height = (h * scale) + 'px';
            
            // –ï—Å–ª–∏ –¥–µ—Ç–∞–ª—å —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∞—è, –Ω–µ –ø–∏—à–µ–º —Ç–µ–∫—Å—Ç
            if (w > 100) div.innerText = `${name}\n${w}x${h}`;

            div.onclick = function() {
                this.classList.toggle('cut'); // –í—ã–¥–µ–ª—è–µ–º –∫–∞–∫ –ø–æ—Ä–µ–∑–∞–Ω–Ω—É—é
                printLabel(name, w + 'x' + h, order); // –ü–µ—á–∞—Ç–∞–µ–º
            };

            plate.appendChild(div);
        }
    }

    function printLabel(name, size, order) {
        document.getElementById('p-name').innerText = name;
        document.getElementById('p-size').innerText = size;
        document.getElementById('p-order').innerText = "–ó–ê–ö–ê–ó: " + order;
        document.getElementById('p-time').innerText = new Date().toLocaleString();
        window.print();
    }
</script>

</body>
</html>
