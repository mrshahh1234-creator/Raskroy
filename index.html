<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Mustafayev Academy | Pro Project Terminal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --bg: #0f172a; --panel: #1e293b; --accent: #10b981; --blue: #3b82f6; --text: #f8fafc;
        }
        body {
            font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text);
            margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden;
        }
        header {
            padding: 10px 30px; background: var(--panel); border-bottom: 2px solid var(--accent);
            display: flex; justify-content: space-between; align-items: center;
        }
        .main-layout { display: grid; grid-template-columns: 1fr 350px; flex: 1; overflow: hidden; }
        
        /* –ö–∞—Ä—Ç–∞ —Ä–∞—Å–∫—Ä–æ—è */
        .canvas-area { padding: 20px; overflow: auto; display: flex; flex-direction: column; align-items: center; background: #111827; }
        .sheet { position: relative; background: #334155; border: 2px solid #4b5563; margin-bottom: 50px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        .part {
            position: absolute; background: rgba(71, 85, 105, 0.9); border: 1px solid rgba(255,255,255,0.2);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: 0.1s; font-size: 12px; font-weight: bold; color: white;
        }
        .part:hover { background: var(--blue); z-index: 5; outline: 3px solid white; }
        .part.selected { background: var(--accent) !important; outline: 3px solid var(--accent); }

        /* –ü–∞–Ω–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (–°—Ç–æ–ª–±–µ—Ü –¥–µ—Ç–∞–ª–µ–π) */
        .info-panel {
            background: var(--panel); border-left: 1px solid #334155; padding: 20px;
            display: flex; flex-direction: column; gap: 15px; overflow-y: auto;
        }
        .detail-item {
            background: #2d3748; padding: 10px; border-radius: 6px; cursor: pointer;
            border-left: 4px solid var(--blue); transition: 0.2s;
        }
        .detail-item:hover { background: #4a5568; }
        .detail-item.active { border-left-color: var(--accent); background: #1a202c; }

        /* –ë–∏—Ä–∫–∞ */
        #print-area {
            display: none; width: 80mm; height: 50mm; background: white; color: black;
            padding: 10px; box-sizing: border-box; font-family: Arial; border: 1px solid #000;
        }
        .label-content { display: grid; grid-template-columns: 1fr 100px; height: 100%; }
        .edge-box { width: 60px; height: 40px; border: 1px solid #000; position: relative; margin: 10px 0; }
        .edge-t { border-top: 4px solid #000; } .edge-b { border-bottom: 4px solid #000; }
        .edge-l { border-left: 4px solid #000; } .edge-r { border-right: 4px solid #000; }

        .btn-load { background: var(--accent); color: white; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<header class="no-print">
    <h2>MUSTAFAYEV ACADEMY <span style="font-weight: 200; font-size: 14px;">| –ò–ù–¢–ï–†–§–ï–ô–° –†–ê–°–ö–†–û–Ø</span></h2>
    <label class="btn-load">üìÇ –û–¢–ö–†–´–¢–¨ –ü–†–û–ï–ö–¢<input type="file" id="fileInput" style="display:none" onchange="handleFile(event)"></label>
</header>

<div class="main-layout no-print">
    <div class="canvas-area" id="canvas">
        <div style="margin-top: 200px; opacity: 0.3;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª .project –∏–ª–∏ .xml –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç</div>
    </div>
    
    <div class="info-panel" id="detailList">
        <h3 style="color: var(--accent); border-bottom: 1px solid #334155; padding-bottom: 10px;">–°–ø–∏—Å–æ–∫ –¥–µ—Ç–∞–ª–µ–π</h3>
        </div>
</div>

<footer class="no-print" style="padding: 10px 30px; background: var(--panel); text-align: right; border-top: 1px solid #334155;">
    Mustafayev <b>Academy</b>
</footer>

<div id="print-area">
    <div class="label-content">
        <div>
            <div style="font-size: 8pt; font-weight: bold; border-bottom: 1px solid #000;">MUSTAFAYEV ACADEMY</div>
            <div id="l-name" style="font-size: 12pt; margin: 5px 0;">–î–µ—Ç–∞–ª—å</div>
            <div id="l-size" style="font-size: 20pt; font-weight: 900;">000 x 000</div>
            <div id="l-mat" style="font-size: 8pt; margin-top: 5px;">–ú–∞—Ç–µ—Ä–∏–∞–ª</div>
            <div class="edge-box" id="l-edges"></div>
            <div id="l-info" style="font-size: 7pt;">–ü—Ä–∏—Å–∞–¥–∫–∞: –ï—Å—Ç—å</div>
        </div>
        <div style="text-align: right; display: flex; flex-direction: column; justify-content: space-between; align-items: flex-end;">
            <div id="l-qr"></div>
            <div id="l-id" style="font-weight: bold; font-size: 10pt;">‚Ññ0</div>
        </div>
    </div>
</div>

<script>
    const SCALE = 0.3; 
    let projectData = [];

    async function handleFile(event) {
        const file = event.target.files[0];
        const text = await file.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(text, "text/xml");
        
        renderProject(xmlDoc);
    }

    function renderProject(xml) {
        const canvas = document.getElementById('canvas');
        const detailList = document.getElementById('detailList');
        canvas.innerHTML = '';
        detailList.innerHTML = '<h3 style="color: var(--accent); border-bottom: 1px solid #334155; padding-bottom: 10px;">–°–ø–∏—Å–æ–∫ –¥–µ—Ç–∞–ª–µ–π</h3>';
        
        const panels = xml.querySelectorAll('[material]');
        
        panels.forEach((panel, pIdx) => {
            const pL = parseInt(panel.getAttribute('l'));
            const pW = parseInt(panel.getAttribute('w'));
            const mat = panel.getAttribute('material');

            const sheet = document.createElement('div');
            sheet.className = 'sheet';
            sheet.style.width = (pL * SCALE) + 'px';
            sheet.style.height = (pW * SCALE) + 'px';
            sheet.innerHTML = `<div style="position:absolute; top:-25px; font-weight:bold; color:var(--accent)">–õ–∏—Å—Ç ${pIdx+1} - ${mat}</div>`;

            const parts = panel.children;
            for(let p of parts) {
                const l = parseFloat(p.getAttribute('l'));
                const w = parseFloat(p.getAttribute('w'));
                const x = parseFloat(p.getAttribute('x'));
                const y = parseFloat(p.getAttribute('y'));
                const id = p.getAttribute('id');

                if (l && w) {
                    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –≤ —Å–ø–∏—Å–∫–µ —Å–ø—Ä–∞–≤–∞
                    const item = document.createElement('div');
                    item.className = 'detail-item';
                    item.innerHTML = `<strong>–î–µ—Ç–∞–ª—å ‚Ññ${id}</strong><br><small>${l} x ${w} –º–º</small>`;
                    detailList.appendChild(item);

                    // –°–æ–∑–¥–∞–µ–º –¥–µ—Ç–∞–ª—å –Ω–∞ –∫–∞—Ä—Ç–µ
                    const div = document.createElement('div');
                    div.className = 'part';
                    div.style.left = (x * SCALE) + 'px';
                    div.style.top = (y * SCALE) + 'px';
                    div.style.width = (l * SCALE) + 'px';
                    div.style.height = (w * SCALE) + 'px';
                    div.innerText = id;

                    const printInfo = { id, l, w, mat, name: "–î–µ—Ç–∞–ª—å "+id };

                    div.onclick = () => {
                        document.querySelectorAll('.part').forEach(el => el.classList.remove('selected'));
                        div.classList.add('selected');
                        printLabel(printInfo);
                    };
                    
                    item.onclick = () => div.click();

                    sheet.appendChild(div);
                }
            }
            canvas.appendChild(sheet);
        });
    }

    function printLabel(data) {
        document.getElementById('l-name').innerText = data.name;
        document.getElementById('l-size').innerText = `${data.l} x ${data.w}`;
        document.getElementById('l-mat').innerText = data.mat;
        document.getElementById('l-id').innerText = "‚Ññ" + data.id;

        // –≠–º—É–ª—è—Ü–∏—è –∫—Ä–æ–º–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ë–∞–∑–∏—Å–µ –Ω—É–∂–Ω–æ —Ç—è–Ω—É—Ç—å –∞—Ç—Ä–∏–±—É—Ç—ã Side1, Side2)
        const edgeBox = document.getElementById('l-edges');
        edgeBox.className = "edge-box edge-t edge-l"; // –ü—Ä–∏–º–µ—Ä: –≤–µ—Ä—Ö –∏ –ª–µ–≤–æ

        const qrBox = document.getElementById('l-qr');
        qrBox.innerHTML = '';
        new QRCode(qrBox, { text: `ID:${data.id}|${data.l}x${data.w}`, width: 90, height: 90 });

        setTimeout(() => { window.print(); }, 300);
    }
</script>
</body>
</html>
